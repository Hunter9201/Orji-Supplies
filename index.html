<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Orji Supplies — Shop</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root{--ink:#0f172a;--muted:#64748b;--line:#e2e8f0;--brand:#0ea5e9;--bg:#f8fafc;--card:#fff}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--ink)}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:12px 16px;z-index:10}
  .wrap{max-width:1200px;margin:0 auto;padding:16px}
  h1{margin:10px 0}
  .muted{color:var(--muted)}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:14px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden;transition:transform .18s, box-shadow .18s}
  .card:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(2,6,23,.10)}
  .card img{width:100%;height:200px;object-fit:cover;background:#f1f5f9}
  .card .body{padding:12px}
  .price{font-weight:800;margin:6px 0}
  .moq{display:inline-block;font-size:11px;background:#d1fae5;color:#065f46;border:1px solid #a7f3d0;border-radius:999px;padding:2px 8px;margin-left:6px}
  .button{padding:10px 14px;border-radius:10px;border:1px solid var(--line);background:#fff;font-weight:700;cursor:pointer;text-decoration:none;color:inherit}
  .primary{background:var(--brand);border-color:var(--brand);color:#fff}
  .bar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
</style>
</head>
<body>
<header>
  <div class="wrap" style="display:flex;justify-content:space-between;align-items:center;gap:10px">
    <strong>Orji Supplies — Shop</strong>
    <div class="bar">
      <a class="button" href="./admin.html">Open Admin</a>
      <button id="reloadBtn" class="button primary">Reload</button>
    </div>
  </div>
</header>

<div class="wrap">
  <h1>Catalog</h1>
  <p class="muted">Cash on Delivery • Kampala</p>
  <div id="grid" class="grid"></div>
  <p id="err" class="muted" style="margin-top:10px"></p>
</div>

<script>
/* ======== EDIT THESE 3 LINES TO MATCH YOUR REPO (same as admin) ======== */
const GH_OWNER = "hunter9201";
const GH_REPO = "Orji-Supplies";
const GH_BRANCH = "main";
const GH_PRODUCTS_PATH = "products.json";
/* ====================================================================== */

// Build raw URL for products.json (CORS-friendly)
function rawUrl(path){
  // IMPORTANT: encode each path segment
  const parts = path.split('/').map(encodeURIComponent).join('/');
  return `https://raw.githubusercontent.com/${GH_OWNER}/${GH_REPO}/${GH_BRANCH}/${parts}`;
}
const PRODUCTS_URL = rawUrl(GH_PRODUCTS_PATH);

const grid = document.getElementById('grid');
const errEl = document.getElementById('err');
const reloadBtn = document.getElementById('reloadBtn');

function fmtUGX(v){ return new Intl.NumberFormat('en-UG',{style:'currency',currency:'UGX',maximumFractionDigits:0}).format(v||0); }
function imgOrFallback(u){ return u || 'https://images.unsplash.com/photo-1585421514284-efb74c2b9d6b?q=80&w=800&auto=format&fit=crop'; }

async function loadProducts(){
  errEl.textContent = "Loading products…";
  grid.innerHTML = "";
  try{
    const r = await fetch(PRODUCTS_URL, {cache:"no-store"});
    if (!r.ok) throw new Error(`Fetch failed ${r.status}`);
    const arr = await r.json();
    if (!Array.isArray(arr)) throw new Error("products.json is not an array");

    if (!arr.length){
      grid.innerHTML = `<div class="muted">No products yet. Use Admin to publish one.</div>`;
      errEl.textContent = "";
      return;
    }

    grid.innerHTML = arr.map(p=>{
      const img = imgOrFallback((Array.isArray(p.imgs)&&p.imgs[0]) ? p.imgs[0] : "");
      return `<div class="card">
        <img src="${img}" alt="${(p.name||'Product')}" onerror="this.src='https://images.unsplash.com/photo-1585421514284-efb74c2b9d6b?q=80&w=800&auto=format&fit=crop'">
        <div class="body">
          <h3 style="margin:0 0 6px">${p.name||'Unnamed'} ${p.moq>1?`<span class="moq">MOQ ${p.moq}</span>`:''}</h3>
          <div class="muted" style="min-height:34px">${p.desc||''}</div>
          <div class="price">${fmtUGX(p.retailPrice)} (Retail) ${p.wholesalePrice?` • Wholesale: ${fmtUGX(p.wholesalePrice)}`:''}</div>
          <div class="muted" style="font-size:12px">Unit: ${p.unit||'piece'} • Category: ${p.category||'-'}</div>
        </div>
      </div>`;
    }).join('');
    errEl.textContent = "";
  }catch(e){
    errEl.textContent = "Failed to load products. Check that products.json exists in your repo and is valid JSON.";
    console.error(e);
  }
}

reloadBtn.addEventListener('click', loadProducts);
loadProducts();
</script>
</body>
</html>
