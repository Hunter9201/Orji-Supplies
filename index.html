<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Orji Supplies – Laundry & Home Cleaning (Cash on Delivery)</title>
  <meta name="description" content="Orji Supplies: Premium laundry & home-cleaning products in Kampala. Retail & wholesale. Cash on Delivery. Fast same-day delivery." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--brand:#0ea5e9;--brand-d:#0284c7;--ink:#0f172a;--muted:#64748b;--line:#e2e8f0;--bg:#f8fafc;--wa:#25D366;--rose:#fb7185;--card:#fff;--ok:#16a34a}
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--ink)}

    .topbar{background:linear-gradient(90deg,var(--brand),#22c55e);color:#fff;padding:6px 14px;font-weight:700;display:flex;justify-content:center;align-items:center;font-size:14px;text-align:center}

    header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);z-index:50;backdrop-filter:saturate(190%) blur(6px)}
    .nav{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;max-width:1200px;margin:0 auto;gap:10px}
    .brand{font-weight:800;font-size:20px;display:flex;align-items:center;gap:10px}
    .brand .logo{width:36px;height:36px;background:var(--brand);color:#fff;border-radius:8px;display:grid;place-items:center;box-shadow:0 6px 14px rgba(14,165,233,.25)}
    .nav-actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .button{padding:10px 14px;border-radius:10px;text-decoration:none;font-weight:800;border:1px solid var(--line);cursor:pointer;background:#fff;color:var(--ink);text-align:center}
    .button:hover{filter:brightness(.98)}
    .primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .primary:hover{background:var(--brand-d)}

    /* HERO */
    .hero{padding:28px 16px;max-width:1000px;margin:0 auto;text-align:center}
    .hero h1{font-size:clamp(24px,6vw,38px);margin:0 0 8px}
    .hero p{color:var(--muted);margin:0 0 14px;font-size:clamp(14px,4vw,16px)}
    .badges{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:10px 0 14px}
    .badge{background:#fff;border:1px solid var(--line);border-radius:999px;padding:6px 10px;font-weight:700;font-size:12px;min-width:120px}
    .hero-cta{display:flex;justify-content:center;gap:12px;flex-wrap:wrap;margin-top:10px}

    /* CONTROLS */
    .controls{position:sticky;top:64px;background:#ffffffd9;backdrop-filter:blur(6px);border-block:1px solid var(--line)}
    .controls-inner{display:flex;flex-direction:column;gap:10px;padding:10px 16px;max-width:1200px;margin:0 auto}
    .tagline{font-weight:700;text-align:center}
    .search{display:flex;gap:8px;align-items:center;padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:#fff;width:100%;max-width:680px;margin:0 auto}
    .search input{border:0;outline:none;width:100%;font-size:14px}
    .chips{display:flex;gap:6px;overflow:auto;padding-bottom:4px;justify-content:center}
    .chip{padding:8px 12px;border-radius:999px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:700;font-size:12px;white-space:nowrap}
    .chip[aria-pressed="true"]{background:var(--ink);color:#fff}
    .mode-tabs{position:relative;display:inline-flex;align-items:center;gap:6px;background:#0f172a0d;border:1px solid #cbd5e1;padding:6px;border-radius:999px}
    .mode-tabs .thumb{position:absolute;top:6px;bottom:6px;width:50%;border-radius:999px;background:var(--brand);z-index:0;transition:transform .25s ease,background-color .25s ease}
    [data-mode="retail"] .mode-tabs .thumb{transform:translateX(0)}
    [data-mode="wholesale"] .mode-tabs .thumb{transform:translateX(100%);background:#16a34a}
    .mode-tabs button{position:relative;z-index:1;border:0;background:transparent;padding:10px 18px;border-radius:999px;font-weight:800;font-size:15px;color:var(--ink);cursor:pointer}
    .mode-tabs button[aria-pressed="true"]{color:#fff}

    h2{font-size:clamp(18px,5vw,22px);margin:12px 0;text-align:center}

    /* GRID */
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px;padding:16px;max-width:1200px;margin:0 auto}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;display:flex;flex-direction:column;overflow:hidden;transition:transform .18s,box-shadow .18s;position:relative}
    .card:hover{transform:translateY(-3px);box-shadow:0 10px 24px rgba(2,6,23,.12)}
    .card .tag{position:absolute;top:10px;left:10px;background:#ffffffea;border:1px solid var(--line);font-weight:800;font-size:11px;border-radius:999px;padding:4px 8px;z-index:5}
    .card .body{padding:12px}
    .card h3{margin:0 0 6px;font-size:16px}
    .price{font-weight:800;margin:6px 0}
    .moq{display:inline-block;font-size:11px;background:#d1fae5;color:#065f46;border:1px solid #a7f3d0;border-radius:999px;padding:2px 8px;margin-left:6px}
    .qtyrow{margin:8px 0;display:flex;align-items:center;gap:8px}
    .qtyrow input{width:96px;padding:8px 10px;border-radius:10px;border:1px solid var(--line)}
    .actions{display:flex;gap:8px;flex-wrap:wrap}

    /* GALLERY (per product) */
    .gallery{display:flex;flex-direction:column;background:#f1f5f9}
    .gallery-main{position:relative;width:100%;aspect-ratio:4/3;overflow:hidden;border-bottom:1px solid var(--line)}
    .gslide{position:absolute;inset:0;opacity:0;transition:opacity .35s ease}
    .gslide.active{opacity:1}
    .gslide img{width:100%;height:100%;object-fit:cover;background:#eef2f7}
    .garrows{position:absolute;inset:0;display:flex;justify-content:space-between;align-items:center;pointer-events:none}
    .garrows button{pointer-events:auto;border:0;background:rgba(0,0,0,.35);color:#fff;width:34px;height:34px;border-radius:50%;display:grid;place-items:center;cursor:pointer}
    .gdots{position:absolute;left:0;right:0;bottom:6px;display:flex;justify-content:center;gap:6px;pointer-events:none}
    .gdots .dot{width:7px;height:7px;border-radius:50%;background:rgba(15,23,42,.35);box-shadow:0 0 0 1px rgba(255,255,255,.5) inset}
    .gdots .dot.active{background:#fff}
    .gthumbs{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;padding:8px}
    .gthumb{position:relative;width:100%;aspect-ratio:1/1;border:2px solid transparent;border-radius:8px;overflow:hidden;cursor:pointer;background:#eef2f7}
    .gthumb.active{border-color:var(--brand)}
    .gthumb img{width:100%;height:100%;object-fit:cover}

    /* DRAWER */
    .drawer{position:fixed;top:0;right:-420px;width:380px;max-width:92vw;height:100vh;background:#fff;border-left:1px solid var(--line);transition:right .22s;z-index:100;display:flex;flex-direction:column}
    .drawer.open{right:0}
    .drawer header{padding:12px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}
    .drawer main{flex:1;overflow:auto;padding:12px}
    .drawer footer{padding:12px;border-top:1px solid var(--line)}

    .fab{position:fixed;right:16px;bottom:16px;display:none;align-items:center;gap:8px;padding:12px 16px;border-radius:999px;background:var(--wa);color:#fff;font-weight:800;text-decoration:none;box-shadow:0 10px 20px rgba(2,6,23,.18);z-index:120}
    .fab:hover{filter:brightness(.96)}

    .trust{max-width:1200px;margin:8px auto 20px;padding:0 16px;display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .tcard{background:#fff;border:1px solid var(--line);border-radius:14px;padding:12px;display:flex;align-items:start;gap:10px}
    .tcard .dot{width:10px;height:10px;border-radius:50%;background:var(--ok);margin-top:6px}

    footer.site{margin-top:20px;border-top:1px solid var(--line);padding:18px 16px;background:#fff;text-align:center}

    /* Mobile niceties */
    .button{min-height:44px}
    @media (min-width:720px){
      .controls-inner{flex-direction:row;flex-wrap:wrap;align-items:center;justify-content:space-between}
      .search{margin:0}
    }
  </style>
</head>
<body data-mode="retail">
  <div class="topbar" role="status" aria-live="polite">
    <span>Pay on Delivery • Same-day Kampala delivery (before 5pm)</span>
  </div>

  <header>
    <div class="nav">
      <div class="brand"><div class="logo">O</div> Orji Supplies</div>
      <div class="nav-actions">
        <a class="button" id="callBtn" href="tel:+256783501222">Call to Order</a>
        <a href="#catalog" class="button primary">Browse Products</a>
        <button id="cartBtn" class="button" type="button">Cart <span id="cartCount" style="background:var(--rose);color:#fff;border-radius:50%;padding:2px 6px;font-size:12px;display:none;">0</span></button>
      </div>
    </div>
  </header>

  <section class="hero">
    <h1>Premium Laundry & Home Cleaning Products</h1>
    <p>Retail & Wholesale • Kampala & Surrounds • Cash on Delivery.</p>
    <div class="badges">
      <span class="badge">Trusted by 1000+ homes</span>
      <span class="badge">Fast delivery</span>
      <span class="badge">Bulk discounts</span>
    </div>
    <div class="hero-cta">
      <a class="button primary" href="#catalog">Shop Now</a>
      <a class="button" id="heroWhatsApp" href="#">WhatsApp Us</a>
    </div>
  </section>

  <div class="controls" id="controls">
    <div class="controls-inner">
      <div class="tagline">Catalog – find what you need fast</div>
      <div class="search" role="search">
        <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M10 2a8 8 0 0 1 6.32 12.9l4.39 4.39l-1.41 1.41l-4.39-4.39A8 8 0 1 1 10 2m0 2a6 6 0 1 0 0 12A6 6 0 0 0 10 4"/></svg>
        <input id="q" type="search" placeholder="Search soap, insecticide, mop…" aria-label="Search products" />
      </div>
      <div class="chips" id="cats" role="tablist" aria-label="Categories">
        <button class="chip" data-cat="all" aria-pressed="true">All</button>
        <button class="chip" data-cat="laundry">Laundry</button>
        <button class="chip" data-cat="home">Home Care</button>
        <button class="chip" data-cat="accessories">Accessories</button>
        <button class="chip" data-cat="pest">Pest Control</button>
      </div>
      <div class="chips" aria-label="Quick filters">
        <button class="chip" id="popularBtn" aria-pressed="false">Popular</button>
        <div class="mode-tabs" role="tablist" aria-label="Mode">
          <div class="thumb" aria-hidden="true"></div>
          <button id="retailBtn" class="mode" data-mode="retail" aria-pressed="true">Retail</button>
          <button id="wholesaleBtn" class="mode" data-mode="wholesale" aria-pressed="false">Wholesale</button>
        </div>
      </div>
    </div>
  </div>

  <main class="wrap">
    <section id="catalog">
      <h2>Catalog</h2>
      <div class="grid" id="grid" aria-live="polite"></div>
    </section>
  </main>

  <!-- Drawer: Cart -->
  <aside id="drawer" class="drawer" aria-label="Cart drawer">
    <header>
      <strong>Your Cart</strong>
      <button id="closeDrawer" class="button" type="button">Close</button>
    </header>
    <main id="cartLines"></main>
    <footer>
      <div id="grandTotal" style="font-weight:800">Total: UGX 0</div>
      <div class="muted" style="margin-top:4px">Payment: Cash on Delivery</div>
    </footer>
  </aside>

  <!-- Checkout FAB -->
  <a id="checkoutFab" class="fab" href="#" target="_blank" aria-label="Checkout on WhatsApp">
    <svg viewBox="0 0 32 32" width="20" height="20" aria-hidden="true"><path fill="currentColor" d="M19.11 17.56c-.26-.13-1.52-.75-1.76-.84s-.41-.13-.58.13-.66.84-.81 1.01-.3.19-.56.06a8.94 8.94 0 0 1-2.64-1.63 9.9 9.9 0 0 1-1.84-2.28c-.19-.32 0-.49.13-.62.13-.13.26-.32.39-.45.13-.13.19-.26.32-.45.13-.19.06-.36 0-.49-.06-.13-.58-1.39-.8-1.89-.21-.51-.43-.44-.58-.45h-.5a.96.96 0 0 0-.69.32c-.24.26-.9.88-.9 2.14s.92 2.49 1.05 2.66c.13.17 1.81 2.76 4.39 3.87.61 .26 1.08 .41 1.45 .52.61 .19 1.16 .16 1.6 .1.49 -.07 1.52 -.62 1.74 -1.22.21 -.58.21 -1.08.15 -1.22-.06 -.13-.24 -.2-.5 -.33zM16 3C9.37 3 4 8.37 4 15c0 2.12.55 4.1 1.52 5.83L4 29l8.33-1.46A12.95 12.95 0 0 0 16 27c6.63 0 12-5.37 12-12S22.63 3 16 3zm0 22.33c-1.84 0-3.55-.54-4.98-1.46l-.36-.23-4.94.86.86-4.81-.24-.39A9.36 9.36 0 1 1 25.36 20a9.33 9.33 0 0 1-9.36 5.33z"/></svg>
    <span>Order</span>
  </a>

  <footer class="site">
    © <span id="year"></span> Orji Supplies • Kampala, Uganda
  </footer>

<script>
  // ===== Config =====
  const WHATSAPP_NUMBER = '256783501222'; // keep as-is; change to your number (no +) when needed

  // Elements
  const grid = document.getElementById('grid');
  const drawer = document.getElementById('drawer');
  const cartBtn = document.getElementById('cartBtn');
  const closeDrawer = document.getElementById('closeDrawer');
  const cartLines = document.getElementById('cartLines');
  const grandTotal = document.getElementById('grandTotal');
  const checkoutFab = document.getElementById('checkoutFab');
  const cartCount = document.getElementById('cartCount');
  const qInput = document.getElementById('q');
  const cats = document.getElementById('cats');
  const popularBtn = document.getElementById('popularBtn');
  const retailBtn = document.getElementById('retailBtn');
  const wholesaleBtn = document.getElementById('wholesaleBtn');
  const heroWhatsApp = document.getElementById('heroWhatsApp');

  // Footer year
  document.getElementById('year').textContent = new Date().getFullYear();

  // State (functionality unchanged)
  let mode = 'retail';
  let cart = new Map();
  let currentCat = 'all';
  let currentQuery = '';
  let popularOnly = false;

  // ===== DO NOT TOUCH: product loading from admin (products.json) =====
  function normalizeImgs(p){
    let arr = Array.isArray(p.imgs) && p.imgs.length ? p.imgs : (p.img ? [p.img] : []);
    if (!arr.length) arr = ['https://images.unsplash.com/photo-1585421514284-efb74c2b9d6b?q=80&w=800&auto=format&fit=crop'];
    return arr.slice(0,4);
  }
  async function loadProducts(){
    try{
      const res = await fetch('products.json', {cache:'no-store'}); // ← unchanged endpoint
      if(!res.ok) throw new Error('products.json missing');
      const arr = await res.json();
      if(Array.isArray(arr) && arr.length) return arr;
    }catch(e){}
    // Fallback sample (only if file missing/empty)
    return [
      {id:'pSample', name:'Sample Product', retailPrice:10000, wholesalePrice:8000, moq:10, category:'home', unit:'piece',
       imgs:['https://images.unsplash.com/photo-1581579188871-45ea61f2a0bb?q=80&w=800&auto=format&fit=crop'],
       desc:'Use your admin to add real products.', popular:true}
    ];
  }

  // Helpers
  const fmtUGX = v => new Intl.NumberFormat('en-UG',{style:'currency',currency:'UGX',maximumFractionDigits:0}).format(v);
  const priceOf = p => mode==='retail' ? p.retailPrice : p.wholesalePrice;
  const minQty  = p => mode==='retail' ? 1 : (p.moq||1);

  // Filters
  function applyFilters(list){
    return list.filter(p=>{
      if (popularOnly && !p.popular) return false;
      if (currentCat !== 'all' && (p.category||'').toLowerCase() !== currentCat) return false;
      if (currentQuery){
        const q = currentQuery.toLowerCase();
        const hay = `${p.name} ${p.desc||''} ${p.category||''}`.toLowerCase();
        if (!hay.includes(q)) return false;
      }
      return true;
    });
  }

  // Gallery HTML per product
  function renderGalleryHTML(imgs, pid){
    const slides = imgs.map((src,i)=>`
      <div class="gslide ${i===0?'active':''}">
        <img src="${src}" alt="Product image ${i+1}" loading="${i===0?'eager':'lazy'}"
             onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1585421514284-efb74c2b9d6b?q=80&w=800&auto=format&fit=crop';">
      </div>`).join('');
    const dots = imgs.map((_,i)=>`<span class="dot ${i===0?'active':''}" data-i="${i}"></span>`).join('');
    const thumbs = imgs.map((src,i)=>`
      <button class="gthumb ${i===0?'active':''}" data-i="${i}" aria-label="Show image ${i+1}">
        <img src="${src}" alt="Thumbnail ${i+1}">
      </button>`).join('');
    return `
      <div class="gallery" data-pid="${pid}">
        <div class="gallery-main">
          ${slides}
          <div class="garrows">
            <button class="gprev" aria-label="Previous image">‹</button>
            <button class="gnext" aria-label="Next image">›</button>
          </div>
          <div class="gdots">${dots}</div>
        </div>
        <div class="gthumbs">${thumbs}</div>
      </div>
    `;
  }

  // Render products
  async function render(){
    const list = await loadProducts();
    const filtered = applyFilters(list);
    if (!filtered.length){
      grid.innerHTML = `<div class="muted" style="text-align:center">No products found. Try a different search or category.</div>`;
      return;
    }
    grid.innerHTML = filtered.map(p=>{
      const imgs = normalizeImgs(p);
      const pr = priceOf(p);
      return `
        <article class="card">
          ${p.popular?'<span class="tag">Popular</span>':''}
          ${renderGalleryHTML(imgs, p.id)}
          <div class="body">
            <h3>${p.name} ${mode==='wholesale'? `<span class="moq">MOQ ${minQty(p)}</span>`:''}</h3>
            <p class="muted" style="min-height:32px">${p.desc||''}</p>
            <div class="price">${fmtUGX(pr)} ${mode==='retail'?'(Retail)':'(Wholesale)'} ${mode==='wholesale'? `<span class="moq">MOQ ${minQty(p)}</span>`:''}</div>
            <div class="muted" style="font-size:12px;margin-top:-2px">
              ${mode==='retail'
                ? `Wholesale: ${fmtUGX(p.wholesalePrice)} (MOQ ${minQty(p)})`
                : `Retail: ${fmtUGX(p.retailPrice)}`
              }
            </div>
            <div class="qtyrow">
              <label class="muted">Qty:
                <input type="number" id="qty-${p.id}" value="${minQty(p)}" min="${minQty(p)}" step="${minQty(p)}" aria-label="Quantity for ${p.name}">
              </label>
              <span class="muted">/ ${p.unit||'piece'}</span>
            </div>
            <div class="actions">
              <button class="button" type="button" onclick="addToCart('${p.id}')">Add to Cart</button>
              <button class="button primary" type="button" onclick="buyNow('${p.id}')">Buy Now</button>
            </div>
          </div>
        </article>
      `;
    }).join('');
    initAllGalleries();
  }

  // Gallery behavior
  const SLIDE_MS = 3200;
  function initAllGalleries(){
    document.querySelectorAll('.gallery').forEach(gal=>{
      const slides = [...gal.querySelectorAll('.gslide')];
      const dots   = [...gal.querySelectorAll('.gdots .dot')];
      const thumbs = [...gal.querySelectorAll('.gthumb')];
      const prevBtn = gal.querySelector('.gprev');
      const nextBtn = gal.querySelector('.gnext');
      let i = 0, timer = null;

      function show(n){
        i = (n + slides.length) % slides.length;
        slides.forEach((s,idx)=>s.classList.toggle('active', idx===i));
        dots.forEach((d,idx)=>d.classList.toggle('active', idx===i));
        thumbs.forEach((t,idx)=>t.classList.toggle('active', idx===i));
      }
      function start(){ if(slides.length>1 && !timer) timer = setInterval(()=>show(i+1), SLIDE_MS); }
      function stop(){ if(timer){ clearInterval(timer); timer = null; } }

      prevBtn.addEventListener('click', ()=>{ stop(); show(i-1); start(); });
      nextBtn.addEventListener('click', ()=>{ stop(); show(i+1); start(); });
      thumbs.forEach(btn=> btn.addEventListener('click', ()=>{ stop(); show(+btn.dataset.i||0); start(); }));
      gal.addEventListener('mouseenter', stop);
      gal.addEventListener('mouseleave', start);

      // Touch swipe
      let sx=0, sy=0, dx=0, dy=0, touching=false;
      gal.addEventListener('touchstart', e=>{
        if(!e.touches[0]) return;
        touching=true; sx=e.touches[0].clientX; sy=e.touches[0].clientY; dx=dy=0; stop();
      }, {passive:true});
      gal.addEventListener('touchmove', e=>{
        if(!touching||!e.touches[0]) return;
        dx = e.touches[0].clientX - sx;
        dy = e.touches[0].clientY - sy;
      }, {passive:true});
      gal.addEventListener('touchend', ()=>{
        if(!touching) return; touching=false;
        if(Math.abs(dx) > 40 && Math.abs(dx) > Math.abs(dy)) (dx < 0) ? show(i+1) : show(i-1);
        start();
      });

      if (slides.length <= 1){
        prevBtn.style.display='none';
        nextBtn.style.display='none';
        gal.querySelector('.gdots').style.display='none';
        gal.querySelector('.gthumbs').style.display='none';
      }

      show(0); start();
    });
  }

  // Cart
  function addToCart(id){
    loadProducts().then(PRODUCTS=>{
      const p = PRODUCTS.find(x=>x.id===id); if(!p) return;
      const qtyEl = document.getElementById(`qty-${id}`);
      let qty = parseInt(qtyEl?.value)||minQty(p);
      if(qty < minQty(p)) qty = minQty(p);
      const unitPrice = priceOf(p);
      const key = id+':'+mode;
      const existing = cart.get(key);
      cart.set(key,{product:p,qty:(existing?existing.qty:0)+qty,unitPrice,mode});
      updateCartUI(); openDrawer();
    });
  }
  function buyNow(id){
    loadProducts().then(PRODUCTS=>{
      const p = PRODUCTS.find(x=>x.id===id); if(!p) return;
      const qtyInput = document.getElementById(`qty-${id}`);
      let qty = parseInt(qtyInput?.value)||minQty(p);
      if(qty < minQty(p)) qty = minQty(p);
      const unitPrice = priceOf(p);
      const msg = `Hi Orji Supplies, I want to order:
• ${p.name} x${qty} @ ${fmtUGX(unitPrice)} (${mode})`;
      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
      window.open(url,'_blank');
    });
  }
  function updateCartUI(){
    cartLines.innerHTML=''; let total=0; let count=0;
    cart.forEach(({product,qty,unitPrice,mode})=>{
      const lineTotal=unitPrice*qty; total+=lineTotal; count+=qty;
      const div=document.createElement('div');
      div.className='line';
      div.innerHTML = `<strong>${product.name}</strong><br>
        <span class="muted">${mode==='retail'?'Retail':'Wholesale'} • ${fmtUGX(unitPrice)} × ${qty}</span>
        — <strong>${fmtUGX(lineTotal)}</strong>`;
      cartLines.appendChild(div);
    });
    grandTotal.textContent='Total: '+fmtUGX(total);
    cartCount.style.display = count>0? 'inline-block':'none';
    cartCount.textContent = count;
    checkoutFab.href = cartToWhatsApp(total);
    updateFabVisibility();
  }
  function cartToWhatsApp(total=0){
    if(cart.size===0) return `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent('Hi Orji Supplies')}`;
    let lines=[];
    cart.forEach(({product,qty,unitPrice,mode})=>{
      lines.push(`• ${product.name} x${qty} @ ${fmtUGX(unitPrice)} (${mode})`);
    });
    const msg = `Order (Cash on Delivery):
${lines.join('
')}
Total: ${fmtUGX(total)}`;
    return `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
  }
  function updateFabVisibility(){
    const visible = cart.size>0 && drawer.classList.contains('open');
    checkoutFab.style.display = visible ? 'flex' : 'none';
  }
  function openDrawer(){ drawer.classList.add('open'); updateFabVisibility(); }
  closeDrawer.onclick=()=>{ drawer.classList.remove('open'); updateFabVisibility(); };
  cartBtn.onclick=()=>{ drawer.classList.toggle('open'); updateFabVisibility(); };

  // Controls wiring
  qInput.addEventListener('input', ()=>{ currentQuery = qInput.value.trim(); render(); });
  cats.addEventListener('click', (e)=>{
    const btn = e.target.closest('.chip');
    if(!btn) return;
    currentCat = btn.dataset.cat;
    [...cats.querySelectorAll('.chip')].forEach(c=>c.setAttribute('aria-pressed', String(c===btn)));
    render();
  });
  document.getElementById('retailBtn').addEventListener('click', ()=> setMode('retail'));
  document.getElementById('wholesaleBtn').addEventListener('click', ()=> setMode('wholesale'));
  if (document.getElementById('popularBtn')) document.getElementById('popularBtn').addEventListener('click', ()=>{
    popularOnly = !popularOnly;
    document.getElementById('popularBtn').setAttribute('aria-pressed', String(popularOnly));
    render();
  });
  function setMode(newMode){
    mode = newMode;
    document.body.setAttribute('data-mode', mode);
    retailBtn.setAttribute('aria-pressed', String(mode==='retail'));
    wholesaleBtn.setAttribute('aria-pressed', String(mode==='wholesale'));
    render();
  }

  // WhatsApp buttons
  function waGreeting(text){
    return `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`;
  }
  document.getElementById('callBtn').setAttribute('href','tel:+256783501222');
  document.getElementById('heroWhatsApp').setAttribute('href', waGreeting('Hi Orji Supplies, I need help placing an order.'));

  // Init
  render();
</script>
</body>
</html>
