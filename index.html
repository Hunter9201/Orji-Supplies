<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orji Supplies – Laundry & Home Cleaning (Cash on Delivery)</title>
  <meta name="description" content="Orji Supplies: Premium laundry & home-cleaning products in Kampala. Retail & wholesale. Cash on Delivery. Fast same‑day delivery." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Favicon -->
  <link rel="icon" href="https://i.postimg.cc/9fwKYW53/Orjii-Supplies.jpg?v=6" type="image/jpeg" sizes="any">
  <link rel="apple-touch-icon" href="https://i.postimg.cc/9fwKYW53/Orjii-Supplies.jpg?v=6">

  <style>
    :root{
      --brand:#0ea5e9;
      --brand-d:#0284c7;
      --ink:#0f172a;
      --muted:#64748b;
      --line:#e2e8f0;
      --bg:#f8fafc;
      --ok:#16a34a;
      --bad:#ef4444;
      --wa:#25D366;
      --gold:#f59e0b;
      --rose:#fb7185;
      --card:#ffffff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body {font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; background:var(--bg); color:var(--ink);}

    /* Top promo bar */
    .topbar{background:linear-gradient(90deg, var(--brand), #22c55e); color:#fff; padding:6px 14px; font-weight:600; display:flex; gap:12px; justify-content:center; align-items:center; font-size:14px}
    .topbar svg{width:16px;height:16px}

    header {position:sticky; top:0; background:#fff; border-bottom:1px solid var(--line); z-index:50; backdrop-filter:saturate(190%) blur(6px)}
    .nav {display:flex; justify-content:space-between; align-items:center; padding:12px 16px; max-width:1200px; margin:0 auto}
    .brand {font-weight:800; font-size:20px; display:flex; align-items:center; gap:10px; letter-spacing:.1px}
    .brand .logo {width:36px;height:36px;background:var(--brand);display:grid;place-items:center;color:#fff;border-radius:8px; box-shadow:0 6px 14px rgba(14,165,233,.25)}
    .nav-actions {display:flex; gap:8px; align-items:center}
    .button {padding:10px 14px; border-radius:10px; text-decoration:none; font-weight:700; border:1px solid var(--line); cursor:pointer; background:#fff; color:var(--ink)}
    .button:hover{filter:brightness(.98)}
    .primary {background:var(--brand); color:#fff; border-color:var(--brand)}
    .primary:hover{background:var(--brand-d); border-color:var(--brand-d)}
    .ghost{background:transparent}
    .call{display:inline-flex; gap:8px; align-items:center}

    /* Hero */
    .hero-wrap{background:conic-gradient(from 180deg at 50% 50%, #e0f2fe 0deg, #dcfce7 180deg, #e0f2fe 360deg)}
    .hero {display:grid; grid-template-columns:1.1fr .9fr; gap:24px; align-items:center; padding:28px 16px; max-width:1200px; margin:0 auto}
    .hero img{border-radius:16px; width:100%; height:100%; object-fit:cover; box-shadow:0 20px 50px rgba(2,6,23,.18)}
    .hero h1{font-size:clamp(28px, 3.6vw, 44px); margin:0 0 8px 0}
    .hero p{color:var(--muted); margin:0 0 14px 0; font-size:clamp(14px, 1.6vw, 16px)}
    .badges{display:flex; flex-wrap:wrap; gap:8px; margin:10px 0 14px}
    .badge{background:#fff; border:1px solid var(--line); border-radius:999px; padding:6px 10px; font-weight:700; font-size:12px}

    /* Controls */
    .controls{position:sticky; top:68px; background:#ffffffd9; backdrop-filter:blur(6px); border-top:1px solid var(--line); border-bottom:1px solid var(--line);}
    .controls-inner{display:flex; justify-content:space-between; align-items:center; gap:12px; padding:10px 16px; max-width:1200px; margin:0 auto}
    .muted{color:var(--muted); font-size:12px}
    .search{display:flex; gap:8px; align-items:center; padding:8px 10px; border:1px solid var(--line); border-radius:10px; background:#fff}
    .search input{border:0; outline:none; min-width:180px}
    .chips{display:flex; flex-wrap:wrap; gap:6px}
    .chip{padding:8px 12px; border-radius:999px; border:1px solid var(--line); background:#fff; cursor:pointer; font-weight:700; font-size:12px}
    .chip[aria-pressed="true"]{background:var(--ink); color:#fff}

    .select{padding:9px 12px; border-radius:10px; border:1px solid var(--line); background:#fff; font-weight:700}

    .mode-badge{padding:8px 12px; border-radius:999px; font-weight:800}
    [data-mode="retail"] .mode-badge{background:#e0f2fe; color:#075985}
    [data-mode="wholesale"] .mode-badge{background:#dcfce7; color:#14532d}

    /* Mode toggle */
    .mode-tabs{
      position:relative; display:inline-flex; align-items:center; gap:6px;
      background:#0f172a0d; border:1px solid #cbd5e1; padding:6px; border-radius:999px;
    }
    .mode-tabs .thumb{position:absolute; top:6px; bottom:6px; width:50%; border-radius:999px; background:var(--brand); z-index:0; transition:transform .25s ease, background-color .25s ease}
    [data-mode="retail"]    .mode-tabs .thumb{ transform:translateX(0%);   background:var(--brand)}
    [data-mode="wholesale"] .mode-tabs .thumb{ transform:translateX(100%); background:#16a34a}
    .mode-tabs button{position:relative; z-index:1; border:0; background:transparent; padding:10px 18px; border-radius:999px; font-weight:800; font-size:15px; color:var(--ink); display:inline-flex; align-items:center; gap:8px; cursor:pointer}
    .mode-tabs button[aria-pressed="true"]{ color:#fff }
    .mode-tabs button:focus-visible{ outline:none; box-shadow:0 0 0 3px rgba(14,165,233,.45) }

    /* Grid */
    .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(230px,1fr)); gap:16px; padding:18px 16px; max-width:1200px; margin:0 auto}
    .card{background:var(--card); border:1px solid var(--line); border-radius:14px; display:flex; flex-direction:column; overflow:hidden; transition:transform .18s, box-shadow .18s}
    .card:hover{transform:translateY(-4px); box-shadow:0 14px 30px rgba(2,6,23,.12)}
    .card .tag{position:absolute; top:10px; left:10px; background:#ffffffea; border:1px solid var(--line); font-weight:800; font-size:11px; border-radius:999px; padding:4px 8px}
    .card .rating{position:absolute; top:10px; right:10px; background:#fff; border:1px solid var(--line); border-radius:999px; padding:4px 8px; font-size:12px; display:flex; align-items:center; gap:4px}
    .card img{width:100%; height:200px; object-fit:cover; background:#f1f5f9}
    .card .body{padding:12px}
    .card h3{margin:0 0 6px; font-size:16px}
    .price{font-weight:800; margin:6px 0}
    .moq{display:inline-block; font-size:11px; background:#d1fae5; color:#065f46; border:1px solid #a7f3d0; border-radius:999px; padding:2px 8px; margin-left:6px}
    .qty{margin:8px 0; display:flex; align-items:center; gap:8px}
    .qty input{width:96px; padding:8px 10px; border-radius:10px; border:1px solid var(--line)}
    .stack{display:flex; gap:8px; flex-wrap:wrap}
    .buyNow{background:#10b981; color:#fff; border-color:#10b981}

    /* Drawer (cart) */
    .drawer{position:fixed; top:0; right:-420px; width:380px; max-width:92vw; height:100vh; background:#fff; border-left:1px solid var(--line); transition:right .22s; z-index:100; display:flex; flex-direction:column}
    .drawer.open{right:0}
    .drawer header{padding:12px; border-bottom:1px solid var(--line); display:flex; justify-content:space-between; align-items:center}
    .drawer main{flex:1; overflow:auto; padding:12px}
    .drawer footer{padding:12px; border-top:1px solid var(--line); position:relative; background:#fff}

    /* Checkout form (modal) */
    .modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(2,6,23,.5); z-index:120}
    .modal.open{display:grid}
    .sheet{width:min(640px,94vw); background:#fff; border:1px solid var(--line); border-radius:16px; box-shadow:0 30px 60px rgba(2,6,23,.35)}
    .sheet header, .sheet footer{padding:12px 16px; border-bottom:1px solid var(--line)}
    .sheet footer{border-top:1px solid var(--line); border-bottom:0; display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap}
    .sheet main{padding:12px 16px}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .field{display:flex; flex-direction:column; gap:6px}
    .field input, .field select, .field textarea{padding:10px 12px; border:1px solid var(--line); border-radius:10px}
    .note{font-size:12px; color:var(--muted)}

    /* Floating WhatsApp checkout button */
    .fab {position: fixed; right: 16px; bottom: 16px; display: none; align-items: center; gap: 8px; padding: 12px 16px; border-radius: 999px; background:var(--wa); color:#fff; font-weight:800; text-decoration:none; box-shadow:0 10px 20px rgba(2,6,23,.18); z-index:120}
    .fab:hover { filter:brightness(.96) }
    .fab svg { width:20px; height:20px }

    /* Trust section */
    .trust{max-width:1200px; margin:8px auto 20px; padding:0 16px; display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:12px}
    .tcard{background:#fff; border:1px solid var(--line); border-radius:14px; padding:12px; display:flex; align-items:start; gap:10px}

    /* Footer */
    footer.site{margin-top:20px; border-top:1px solid var(--line); padding:18px 16px; background:#fff}

    /* Responsive */
    @media (max-width: 940px){ .hero{grid-template-columns:1fr} .controls{top:60px} }
  /* --- Mobile & small-screen enhancements --- */
    .card h3{display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; min-height:40px}
    @media (max-width: 940px){
      .controls-inner{flex-wrap:wrap}
    }
    @media (max-width: 640px){
      .nav{padding:10px 12px}
      .hero{padding:16px}
      .hero img{border-radius:12px}
      .controls{top:56px}
      .controls-inner{gap:8px}
      .search{flex:1; width:100%}
      .chips{width:100%; overflow:auto; -webkit-overflow-scrolling:touch}
      .mode-tabs{width:100%; justify-content:space-between}
      .mode-badge{width:100%; text-align:center}
      .grid{grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px; padding:12px}
      .card img{height:150px}
      .card .stack{flex-direction:column}
      .qty input{width:100%}
      .drawer{width:100vw}
      .sheet{width:100vw; max-height:90vh}
      .sheet main{max-height:calc(90vh - 120px); overflow:auto}
    }
    @media (max-width: 380px){
      .grid{grid-template-columns:1fr}
      .card img{height:160px}
      .button{width:100%}
    }
  </style>
</head>
<body data-mode="retail">
  <!-- Promo bar -->
  <div class="topbar" role="status" aria-live="polite">
    <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2 1 21h22L12 2zm0 4.84L19.53 19H4.47L12 6.84zM11 10h2v5h-2v-5zm0 6h2v2h-2v-2z"/></svg>
    <span>Pay on Delivery (Cash) • Same‑day delivery in Kampala before 4pm • Free delivery on orders UGX 250,000+</span>
  </div>

  <header>
    <div class="nav">
      <div class="brand"><div class="logo">O</div> Orji Supplies</div>
      <div class="nav-actions">
        <a class="button ghost call" href="tel:+256700000000" title="Call to order">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path fill="currentColor" d="M6.62 10.79a15.05 15.05 0 006.59 6.59l2.2-2.2a1 1 0 011.01-.24 11.36 11.36 0 003.56.57 1 1 0 011 1V20a1 1 0 01-1 1A17 17 0 013 4a1 1 0 011-1h3.5a1 1 0 011 1 11.36 11.36 0 00.57 3.56 1 1 0 01-.24 1.01l-2.2 2.2z"/></svg>
          +256 700 000 000
        </a>
        <a href="#catalog" class="button primary">Browse Products</a>
        <button id="cartBtn" class="button">Cart <span id="cartCount" style="background:var(--rose); color:#fff; border-radius:50%; padding:2px 6px; font-size:12px; display:none;">0</span></button>
      </div>
    </div>
  </header>

  <div class="hero-wrap">
    <section class="hero">
      <div>
        <h1>Premium Laundry & Home Cleaning Products</h1>
        <p>Retail & Wholesale • Kampala & Surrounds • Cash on Delivery. Brooms, insect killers, toilet cleaners, polishes, and more.</p>
        <div class="badges">
          <span class="badge">Trusted by 500+ homes</span>
          <span class="badge">Fast Kampala delivery</span>
          <span class="badge">Bulk discounts</span>
        </div>
        <div class="stack">
          <a href="#catalog" class="button primary">Shop Now</a>
          <a class="button" target="_blank" href="https://wa.me/256700000000?text=Hi%20Orji%20Supplies%2C%20I%20want%20to%20place%20an%20order%20(Cash%20on%20Delivery).">WhatsApp Us</a>
        </div>
      </div>
      <img src="https://i.postimg.cc/MHkXsZrh/profile.png" alt="Orji Supplies team with products" loading="eager" width="1200" height="700">
    </section>
  </div>

  <!-- Controls: Search, filters, sort, retail/wholesale toggle -->
  <div class="controls">
    <div class="controls-inner">
      <div class="stack" style="align-items:center">
        <strong>Catalog</strong> <span class="muted">– find what you need fast</span>
      </div>

      <div class="search" role="search">
        <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true"><path fill="currentColor" d="M10 2a8 8 0 105.3 14.1l4.3 4.3 1.4-1.4-4.3-4.3A8 8 0 0010 2zm0 2a6 6 0 110 12 6 6 0 010-12z"/></svg>
        <input id="searchInput" placeholder="Search soap, insecticide, mop…" aria-label="Search products" />
      </div>

      <div class="chips" id="chips" role="group" aria-label="Filter by category"></div>
      <div id="modeBadge" class="mode-badge">Retail Mode – single units</div>

      <select id="sortSel" class="select" aria-label="Sort products">
        <option value="pop">Popular</option>
        <option value="priceAsc">Price: Low → High</option>
        <option value="priceDesc">Price: High → Low</option>
        <option value="name">Name A → Z</option>
      </select>

      <div class="mode-tabs" id="modeTabs" aria-label="Buying mode" role="group">
        <span class="thumb" aria-hidden="true"></span>
        <button type="button" data-mode="retail" aria-pressed="true" title="Buy single units at retail price">Retail</button>
        <button type="button" data-mode="wholesale" aria-pressed="false" title="Buy in bulk at wholesale price">Wholesale</button>
      </div>
    </div>
  </div>

  <!-- Product grid -->
  <section id="catalog">
    <div class="grid" id="grid"></div>
  </section>

  <!-- Trust section -->
  <section class="trust" aria-label="Why shop with Orji">
    <div class="tcard">
      <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true"><path fill="currentColor" d="M12 2l7 4v6c0 5-3.8 9.7-7 10-3.2-.3-7-5-7-10V6l7-4z"/></svg>
      <div>
        <strong>Cash on Delivery</strong>
        <div class="muted">Pay only when your items arrive. Simple & secure.</div>
      </div>
    </div>
    <div class="tcard">
      <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true"><path fill="currentColor" d="M3 6h18v2H3V6zm2 5h14v11H5V11zm3 2v7h2v-7H8zm6 0v7h2v-7h-2z"/></svg>
      <div>
        <strong>Same‑Day Delivery</strong>
        <div class="muted">Kampala orders before 4pm delivered the same day.</div>
      </div>
    </div>
    <div class="tcard">
      <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true"><path fill="currentColor" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
      <div>
        <strong>Top‑Rated Brands</strong>
        <div class="muted">Harpic, Vim, Pledge, Durakill, and more favourites.</div>
      </div>
    </div>
    <div class="tcard">
      <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true"><path fill="currentColor" d="M12 4a8 8 0 00-8 8v4h2v-4a6 6 0 1112 0v4h2v-4a8 8 0 00-8-8zM6 18h12v2H6v-2z"/></svg>
      <div>
        <strong>Wholesale Ready</strong>
        <div class="muted">Bulk discounts & easy re‑order for businesses.</div>
      </div>
    </div>
    <div class="tcard">
      <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true"><path fill="currentColor" d="M3 13h2v-2H3V9h4V7h2v2h6V7h2v2h4v2h-2v2h2v2h-4v2h-2v-2H9v2H7v-2H3v-2zm6-2v2h6v-2H9z"/></svg>
      <div>
        <strong>Free Delivery 250k+ UGX</strong>
        <div class="muted">Automatic at checkout when your cart reaches UGX 250,000.</div>
      </div>
    </div>
    </div>
  </section>

  <footer class="site">
    <div style="max-width:1200px; margin:0 auto; display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content:space-between">
      <p>© <span id="year"></span> Orji Supplies. Kampala, Uganda.</p>
      <div class="muted">Call <a href="tel:+256700000000">+256 700 000 000</a> • WhatsApp <a target="_blank" href="https://wa.me/256700000000">chat</a></div>
    </div>
  </footer>

  <!-- Cart Drawer -->
  <aside id="drawer" class="drawer" aria-label="Cart drawer" aria-live="polite">
    <header>
      <strong>Your Cart</strong>
      <button id="closeDrawer" class="button">Close</button>
    </header>
    <main id="cartLines"></main>
    <footer>
      <div id="grandTotal" style="font-weight:800">Total: UGX 0</div>
      <div class="muted" style="margin:6px 0">Payment: <strong>Cash on Delivery</strong></div>
      <div class="muted" style="margin:6px 0">Delivery area: <select id="areaSel" class="select" style="padding:6px 8px">
        <option value="Kampala Central">Kampala Central</option>
        <option value="Wakiso">Wakiso</option>
        <option value="Entebbe">Entebbe</option>
        <option value="Upcountry">Upcountry</option>
      </select></div>
      <div id="deliveryNote" class="muted">Same‑day in Kampala for orders before 4pm. Estimated fee shown at checkout.</div>
      <div id="freeNote" class="muted" style="margin:6px 0"></div>
      <div id="freeProgress" style="height:8px; background:#f1f5f9; border-radius:999px; overflow:hidden;">
        <div id="freeFill" style="height:100%; width:0; background:var(--ok)"></div>
      </div>
      <div class="stack" style="margin-top:10px">
        <button id="openCheckout" class="button primary">Proceed to Checkout</button>
      </div>
    </footer>
  </aside>

  <!-- Floating WhatsApp Checkout (appears only when drawer open & items present) -->
  <a id="checkoutFab" class="fab" href="#" target="_blank" aria-label="Checkout on WhatsApp (COD)">
    <svg viewBox="0 0 32 32" aria-hidden="true"><path fill="currentColor" d="M19.11 17.56c-.26-.13-1.52-.75-1.76-.84s-.41-.13-.58.13-.66.84-.81 1.01-.3.19-.56.06a8.94 8.94 0 0 1-2.64-1.63 9.9 9.9 0 0 1-1.84-2.28c-.19-.32 0-.49.13-.62.13-.13.26-.32.39-.45.13-.13.19-.26.32-.45.13-.19.06-.36 0-.49-.06-.13-.58-1.39-.8-1.89-.21-.51-.43-.44-.58-.45h-.5a.96.96 0 0 0-.69.32c-.24.26-.9.88-.9 2.14s.92 2.49 1.05 2.66c.13.17 1.81 2.76 4.39 3.87.61.26 1.08.41 1.45.52.61.19 1.16.16 1.6.1.49-.07 1.52-.62 1.74-1.22.21-.58.21-1.08.15-1.22-.06-.13-.24-.2-.5-.33zM16 3C9.37 3 4 8.37 4 15c0 2.12.55 4.1 1.52 5.83L4 29l8.33-1.46A12.95 12.95 0 0 0 16 27c6.63 0 12-5.37 12-12S22.63 3 16 3zm0 22.33c-1.84 0-3.55-.54-4.98-1.46l-.36-.23-4.94.86.86-4.81-.24-.39A9.36 9.36 0 1 1 25.36 20a9.33 9.33 0 0 1-9.36 5.33z"/></svg>
    <span>Checkout</span>
  </a>

  <!-- Checkout Modal -->
  <div id="checkoutModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="ckTitle">
    <div class="sheet">
      <header><strong id="ckTitle">Cash on Delivery – Delivery Details</strong></header>
      <main>
        <div class="row">
          <div class="field">
            <label for="custName">Full Name</label>
            <input id="custName" placeholder="e.g., Amina Namusoke" autocomplete="name" />
          </div>
          <div class="field">
            <label for="custPhone">Phone (for rider)</label>
            <input id="custPhone" placeholder="e.g., 07xx xxx xxx" inputmode="tel" autocomplete="tel" />
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label for="custArea">Delivery Area</label>
            <select id="custArea">
              <option>Kampala Central</option>
              <option>Wakiso</option>
              <option>Entebbe</option>
              <option>Upcountry</option>
            </select>
            <div class="note">Kampala same‑day for orders before 4pm.</div>
          </div>
          <div class="field">
            <label for="custTime">Preferred Time</label>
            <select id="custTime">
              <option>Anytime Today</option>
              <option>Morning (8am–12pm)</option>
              <option>Afternoon (12–4pm)</option>
              <option>Evening (4–8pm)</option>
            </select>
          </div>
        </div>
        <div class="field">
          <label for="custAddr">Exact Address / Landmarks</label>
          <textarea id="custAddr" rows="3" placeholder="House 12, Makerere Kikoni, near XYZ pharmacy"></textarea>
        </div>
        <div class="field">
          <label for="custNote">Order Note (optional)</label>
          <input id="custNote" placeholder="e.g., Call on arrival, don’t ring bell" />
        </div>
        <div class="note">Payment Method: <strong>Cash on Delivery</strong>. You will pay after your items arrive.</div>
      </main>
      <footer>
        <button id="closeModal" class="button">Cancel</button>
        <a id="placeOrderBtn" class="button primary" target="_blank">Place Order on WhatsApp</a>
      </footer>
    </div>
  </div>

  <script>
    // ====== Config ======
    const WHATSAPP_NUMBER = '256700000000'; // set your business WhatsApp number here (no +)
    const CALL_NUMBER = '+256700000000';
    const FREE_THRESHOLD = 250000;

    // Base folder for local images (use a folder, not .html)
    const IMG_BASE = 'images/';
    function withBase(path){
      if (/^https?:\/\//i.test(path)) return path; // absolute URL stays
      const base = IMG_BASE.endsWith('/') ? IMG_BASE : IMG_BASE + '/';
      return base + path.split('/').map(encodeURIComponent).join('/');
    }

    // ====== Catalog Data ======
    // categories: 'laundry', 'home', 'accessories', 'pest'
    // rating: 3.5 - 5 (visual only)
    const PRODUCTS = [
      {id:'pBroom', name:'Assorted Color Broom Head', retailPrice:15000, wholesalePrice:12000, moq:10, category:'accessories', unit:'piece',  img:'https://i.postimg.cc/TwjsBpHm/Brooms.jpg', desc:'Heavy-duty broom head in multiple colors. Fits standard handles.', rating:4.7, tag:'Bestseller'},
      {id:'pDurakill', name:'Durakill Multi Insect Killer 600ml', retailPrice:18000, wholesalePrice:15000, moq:12, category:'pest', unit:'can', img:'https://images.unsplash.com/photo-1563453392212-326f5e854473?q=80&w=1200&auto=format&fit=crop', desc:'Rapid knock-down insecticide for flying & crawling insects.', rating:4.6},
      {id:'pHarpic', name:'Harpic Power Plus 10X (750ml)', retailPrice:16000, wholesalePrice:14000, moq:12, category:'home', unit:'bottle', img:'https://images.unsplash.com/photo-1615486363873-5cc9c13ccd3d?q=80&w=1200&auto=format&fit=crop', desc:'Powerful toilet cleaner for tough stains and germs.', rating:4.8, tag:'Top Brand'},
      {id:'pMop', name:'Microfiber Floor Mop (Squeeze Type)', retailPrice:45000, wholesalePrice:40000, moq:4, category:'accessories', unit:'set', img:'https://images.unsplash.com/photo-1488805990569-3c9e1d76d51c?q=80&w=1200&auto=format&fit=crop', desc:'High-absorbency microfiber mop with extendable handle.', rating:4.5},
      {id:'pKilltox', name:'Super Killtox Insecticide Aerosol', retailPrice:15000, wholesalePrice:13000, moq:12, category:'pest', unit:'can', img:'https://images.unsplash.com/photo-1563453392212-326f5e854473?q=80&w=1200&auto=format&fit=crop', desc:'Universal formula for home pest control.', rating:4.4},
      {id:'pToiletBrush', name:'Toilet Brush & Holder Set (805)', retailPrice:20000, wholesalePrice:17000, moq:6, category:'accessories', unit:'set', img:'https://images.unsplash.com/photo-1595433707802-6b2626ef1c91?q=80&w=1200&auto=format&fit=crop', desc:'Durable toilet brush with drip-catching holder.', rating:4.3},
      {id:'pPledge', name:'Pledge Furniture Polish 300ml', retailPrice:23000, wholesalePrice:20000, moq:12, category:'home', unit:'can', img:'https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?q=80&w=1200&auto=format&fit=crop', desc:'Shines and protects wooden furniture.', rating:4.6},
      {id:'pVim', name:'Vim Scouring Powder 500g', retailPrice:8000, wholesalePrice:7000, moq:24, category:'home', unit:'tin', img:'https://images.unsplash.com/photo-1615486363873-5cc9c13ccd3d?q=80&w=1200&auto=format&fit=crop', desc:'Classic lemon scouring powder for pots, pans & sinks.', rating:4.7},
      {id:'pSoftener', name:'Fabric Softener 2L', retailPrice:26000, wholesalePrice:23000, moq:8, category:'laundry', unit:'bottle', img:'https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?q=80&w=1200&auto=format&fit=crop', desc:'Keeps clothes soft and reduces static.', rating:4.5},
      {id:'pFloorCleaner', name:'Disinfectant Floor Cleaner 5L', retailPrice:42000, wholesalePrice:38000, moq:6, category:'home', unit:'jerrycan', img:'https://images.unsplash.com/photo-1527515637462-cff94eecc1ac?q=80&w=1200&auto=format&fit=crop', desc:'Long-lasting freshness, kills 99.9% germs.', rating:4.6, tag:'Bulk saver'},
      {id:'pLiquidSoap', name:'Antibacterial Liquid Soap 5L', retailPrice:38000, wholesalePrice:34000, moq:4, category:'laundry', unit:'jerrycan', img:'https://images.unsplash.com/photo-1581578731548-c64695cc6952?q=80&w=1200&auto=format&fit=crop', desc:'Food-safe hand & dish soap with aloe.', rating:4.7},
      {id:'pBleach', name:'Oxygen Bleach 1kg', retailPrice:24000, wholesalePrice:21000, moq:10, category:'laundry', unit:'tub', img:'https://images.unsplash.com/photo-1556228578-8fbf4d0d85d9?q=80&w=1200&auto=format&fit=crop', desc:'Whitening booster for fabrics. Chlorine-free.', rating:4.4},
      {id:'pDetergentPowder', name:'Ultra Wash Detergent Powder 3kg', retailPrice:36000, wholesalePrice:32000, moq:6, category:'laundry', unit:'bag', img:'https://images.unsplash.com/photo-1581579188871-45ea61f2a0bb?q=80&w=1200&auto=format&fit=crop', desc:'Powerful stain removal, fresh fragrance.', rating:4.8, tag:'Bestseller'},
      {id:'pSpongePack', name:'Kitchen Sponge Pack (6pcs)', retailPrice:9000, wholesalePrice:7000, moq:12, category:'accessories', unit:'pack', img:'https://images.unsplash.com/photo-1596967741295-7d4b1a9da8d3?q=80&w=1200&auto=format&fit=crop', desc:'Non-scratch foam scrub sponges.', rating:4.2},
      {id:'pGarbageBags', name:'Heavy Duty Garbage Bags (30pcs)', retailPrice:18000, wholesalePrice:15000, moq:10, category:'home', unit:'roll', img:'https://images.unsplash.com/photo-1603796846097-bee99e4a601f?q=80&w=1200&auto=format&fit=crop', desc:'Extra‑thick trash liners for home & office.', rating:4.4},
      {id:'pAirFresh', name:'Air Freshener Spray 300ml', retailPrice:15000, wholesalePrice:12000, moq:12, category:'home', unit:'can', img:'https://images.unsplash.com/photo-1556228453-efd1b4c4373c?q=80&w=1200&auto=format&fit=crop', desc:'Instant room refresh – multiple scents.', rating:4.3},
      {id:'pGloves', name:'Reusable Latex Gloves (L)', retailPrice:12000, wholesalePrice:9000, moq:20, category:'accessories', unit:'pair', img:'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?q=80&w=1200&auto=format&fit=crop', desc:'Tough, non‑slip cleaning gloves.', rating:4.5},
      {id:'pSqueegee', name:'Window Squeegee 35cm', retailPrice:18000, wholesalePrice:15000, moq:8, category:'accessories', unit:'piece', img:'https://images.unsplash.com/photo-1583947215259-38c97076f0d8?q=80&w=1200&auto=format&fit=crop', desc:'Streak‑free glass cleaning tool.', rating:4.1},
      {id:'pDishBrush', name:'Dish Brush with Soap Dispenser', retailPrice:16000, wholesalePrice:13000, moq:12, category:'accessories', unit:'piece', img:'https://images.unsplash.com/photo-1607619056574-7ab35c0f11a3?q=80&w=1200&auto=format&fit=crop', desc:'Push to release soap while scrubbing.', rating:4.4},
      {id:'pToiletGel', name:'Toilet Cleaning Gel 750ml', retailPrice:17000, wholesalePrice:14000, moq:12, category:'home', unit:'bottle', img:'https://images.unsplash.com/photo-1595407754044-4da7a6d4fcac?q=80&w=1200&auto=format&fit=crop', desc:'Clings to bowl for deep clean.', rating:4.6},
      {id:'pStainRemover', name:'Fabric Stain Remover 500ml', retailPrice:22000, wholesalePrice:19000, moq:10, category:'laundry', unit:'bottle', img:'https://images.unsplash.com/photo-1628648844220-4a7e7d70c2b2?q=80&w=1200&auto=format&fit=crop', desc:'Targets grease, mud and ink stains.', rating:4.5},
      {id:'pCarpetCleaner', name:'Carpet & Upholstery Shampoo 1L', retailPrice:28000, wholesalePrice:24000, moq:8, category:'home', unit:'bottle', img:'https://images.unsplash.com/photo-1558449028-b53a39d116ec?q=80&w=1200&auto=format&fit=crop', desc:'Foaming deep‑clean for fabric surfaces.', rating:4.2},
      {id:'pSteelWool', name:'Steel Wool Pads (16pcs)', retailPrice:9000, wholesalePrice:7000, moq:12, category:'accessories', unit:'pack', img:'https://images.unsplash.com/photo-1599058944790-48c4c002d070?q=80&w=1200&auto=format&fit=crop', desc:'Cuts through burnt‑on grime.', rating:4.3},
      {id:'pHandSan', name:'Hand Sanitizer 500ml', retailPrice:18000, wholesalePrice:15000, moq:12, category:'home', unit:'bottle', img:'https://images.unsplash.com/photo-1583947215259-38c97076f0d8?q=80&w=1200&auto=format&fit=crop', desc:'70% alcohol, moisturising formula.', rating:4.6},
      {id:'pBuckets', name:'Multi‑purpose Bucket 20L', retailPrice:26000, wholesalePrice:22000, moq:6, category:'accessories', unit:'piece', img:'https://images.unsplash.com/photo-1602143407151-7111542de8bb?q=80&w=1200&auto=format&fit=crop', desc:'Strong handle, durable plastic.', rating:4.1},
      {id:'pClothPeg', name:'Clothes Pegs (50pcs)', retailPrice:12000, wholesalePrice:9000, moq:10, category:'accessories', unit:'pack', img:'https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1200&auto=format&fit=crop', desc:'Non‑slip pegs for outdoor lines.', rating:4.0},
      {id:'pDishLiquid', name:'Dishwashing Liquid 1L (Lemon)', retailPrice:14000, wholesalePrice:12000, moq:12, category:'home', unit:'bottle', img:'https://images.unsplash.com/photo-1604335399105-a0fcc0d04d2e?q=80&w=1200&auto=format&fit=crop', desc:'Degreasing power with lemon scent.', rating:4.5},
      {id:'pJik', name:'Jik Bleach 1L', retailPrice:16000, wholesalePrice:14000, moq:12, category:'laundry', unit:'bottle', img:'https://images.unsplash.com/photo-1556228578-8fbf4d0d85d9?q=80&w=1200&auto=format&fit=crop', desc:'Trusted household bleach for whitening & hygiene.', rating:4.6},
      {id:'pDettol', name:'Dettol Antiseptic 500ml', retailPrice:28000, wholesalePrice:25000, moq:8, category:'home', unit:'bottle', img:'https://images.unsplash.com/photo-1583947215259-38c97076f0d8?q=80&w=1200&auto=format&fit=crop', desc:'Multi‑purpose antiseptic liquid.', rating:4.8},
      {id:'pOmo', name:'Omo Washing Powder 2kg', retailPrice:31000, wholesalePrice:28000, moq:8, category:'laundry', unit:'bag', img:'https://images.unsplash.com/photo-1581579188871-45ea61f2a0bb?q=80&w=1200&auto=format&fit=crop', desc:'Deep clean washing powder.', rating:4.7},
      {id:'pSunlight', name:'Sunlight Liquid Detergent 1.5L', retailPrice:26000, wholesalePrice:23000, moq:10, category:'laundry', unit:'bottle', img:'https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?q=80&w=1200&auto=format&fit=crop', desc:'Gentle on hands, tough on grease.', rating:4.6},
      {id:'pGlass', name:'Glass Cleaner 500ml', retailPrice:14000, wholesalePrice:12000, moq:12, category:'home', unit:'bottle', img:'https://images.unsplash.com/photo-1527515637462-cff94eecc1ac?q=80&w=1200&auto=format&fit=crop', desc:'Crystal‑clear, streak‑free shine.', rating:4.5},
      {id:'pDrain', name:'Drain Cleaner Gel 1L', retailPrice:24000, wholesalePrice:21000, moq:6, category:'home', unit:'bottle', img:'https://images.unsplash.com/photo-1595407754044-4da7a6d4fcac?q=80&w=1200&auto=format&fit=crop', desc:'Unclogs sinks & drains fast.', rating:4.2},
      {id:'pCoils', name:'Mosquito Coils (10pcs)', retailPrice:8000, wholesalePrice:6000, moq:20, category:'pest', unit:'box', img:'https://images.unsplash.com/photo-1505575972945-280c5cf51129?q=80&w=1200&auto=format&fit=crop', desc:'Long‑lasting protection from mosquitoes.', rating:4.1},
      {id:'pRatGlue', name:'Rat Glue Traps (5pcs)', retailPrice:12000, wholesalePrice:9000, moq:20, category:'pest', unit:'pack', img:'https://images.unsplash.com/photo-1545239351-1141bd82e8a6?q=80&w=1200&auto=format&fit=crop', desc:'Strong adhesive boards for rodents.', rating:4.0},
      {id:'pOven', name:'Oven Cleaner Spray 650ml', retailPrice:26000, wholesalePrice:23000, moq:8, category:'home', unit:'can', img:'https://images.unsplash.com/photo-1599058944790-48c4c002d070?q=80&w=1200&auto=format&fit=crop', desc:'Cuts through baked‑on grease.', rating:4.3},
      {id:'pDescaler', name:'Bathroom Limescale Remover 1L', retailPrice:24000, wholesalePrice:21000, moq:6, category:'home', unit:'bottle', img:'https://images.unsplash.com/photo-1558449028-b53a39d116ec?q=80&w=1200&auto=format&fit=crop', desc:'Dissolves limescale & soap scum.', rating:4.2},
      {id:'pNaph', name:'Naphthalene Balls 200g', retailPrice:10000, wholesalePrice:8000, moq:20, category:'home', unit:'pack', img:'https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1200&auto=format&fit=crop', desc:'Protect clothes from moths & odor.', rating:4.1},
      {id:'pTP', name:'Toilet Paper (10‑Pack)', retailPrice:18000, wholesalePrice:16000, moq:12, category:'home', unit:'pack', img:'https://images.unsplash.com/photo-1584556812952-905ffd0c611f?q=80&w=1200&auto=format&fit=crop', desc:'Soft, strong household essential.', rating:4.6},
      {id:'pTowels', name:'Kitchen Paper Towels (6‑Pack)', retailPrice:24000, wholesalePrice:21000, moq:10, category:'home', unit:'pack', img:'https://images.unsplash.com/photo-1581578731548-c64695cc6952?q=80&w=1200&auto=format&fit=crop', desc:'Super‑absorbent rolls for spills.', rating:4.4}
    ];

    /* Extra products for fuller mobile catalog */
    PRODUCTS.push(
      {id:'pMicroCloth', name:'Microfiber Cleaning Cloths (5pcs)', retailPrice:12000, wholesalePrice:9000, moq:12, category:'accessories', unit:'pack', img:'https://images.unsplash.com/photo-1581579188871-45ea61f2a0bb?q=80&w=1200&auto=format&fit=crop', desc:'Lint‑free cloths for streak‑free cleaning.', rating:4.5},
      {id:'pFloorWiper', name:'Floor Wiper 45cm', retailPrice:24000, wholesalePrice:20000, moq:10, category:'accessories', unit:'piece', img:'https://images.unsplash.com/photo-1488805990569-3c9e1d76d51c?q=80&w=1200&auto=format&fit=crop', desc:'Wide head wiper for quick drying floors.', rating:4.2},
      {id:'pLiquidDetergent5L', name:'Liquid Detergent 5L (Blue)', retailPrice:38000, wholesalePrice:34000, moq:6, category:'laundry', unit:'jerrycan', img:'https://images.unsplash.com/photo-1581578731548-c64695cc6952?q=80&w=1200&auto=format&fit=crop', desc:'High‑foam formula for clothes and floors.', rating:4.6},
      {id:'pTileCleaner', name:'Tile & Grout Cleaner 1L', retailPrice:26000, wholesalePrice:23000, moq:8, category:'home', unit:'bottle', img:'https://images.unsplash.com/photo-1527515637462-cff94eecc1ac?q=80&w=1200&auto=format&fit=crop', desc:'Removes stubborn stains and limescale.', rating:4.4},
      {id:'pShoePolishSet', name:'Shoe Polish Set (Black & Brown)', retailPrice:16000, wholesalePrice:13000, moq:20, category:'home', unit:'set', img:'https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?q=80&w=1200&auto=format&fit=crop', desc:'Shine kit for leather shoes.', rating:4.3},
      {id:'pLaundryBasket', name:'Laundry Basket 50L', retailPrice:45000, wholesalePrice:40000, moq:6, category:'accessories', unit:'piece', img:'https://images.unsplash.com/photo-1602143407151-7111542de8bb?q=80&w=1200&auto=format&fit=crop', desc:'Lightweight ventilated basket.', rating:4.2}
    );

    const CATEGORIES = [
      {id:'all', label:'All'},
      {id:'laundry', label:'Laundry'},
      {id:'home', label:'Home Care'},
      {id:'accessories', label:'Accessories'},
      {id:'pest', label:'Pest Control'}
    ];

    // ====== Elements ======
    const grid = document.getElementById('grid');
    const cartBtn = document.getElementById('cartBtn');
    const drawer = document.getElementById('drawer');
    const closeDrawer = document.getElementById('closeDrawer');
    const cartLines = document.getElementById('cartLines');
    const grandTotal = document.getElementById('grandTotal');
    const checkoutFab = document.getElementById('checkoutFab');
    const cartCount = document.getElementById('cartCount');
    const areaSel = document.getElementById('areaSel');
    const modeTabs = document.getElementById('modeTabs');
    const searchInput = document.getElementById('searchInput');
    const chips = document.getElementById('chips');
    const sortSel = document.getElementById('sortSel');
    const openCheckout = document.getElementById('openCheckout');
    const freeNote = document.getElementById('freeNote');
    const freeFill = document.getElementById('freeFill');
    const modeBadge = document.getElementById('modeBadge');

    // Modal elements
    const checkoutModal = document.getElementById('checkoutModal');
    const closeModal = document.getElementById('closeModal');
    const placeOrderBtn = document.getElementById('placeOrderBtn');
    const custName = document.getElementById('custName');
    const custPhone = document.getElementById('custPhone');
    const custArea = document.getElementById('custArea');
    const custTime = document.getElementById('custTime');
    const custAddr = document.getElementById('custAddr');
    const custNote = document.getElementById('custNote');

    // ====== State ======
    let mode = 'retail';
    let cart = new Map(); // key: id:mode
    let activeCat = 'all';

    // ====== Utils ======
    const fmtUGX = v => new Intl.NumberFormat('en-UG', {style:'currency', currency:'UGX', maximumFractionDigits:0}).format(v);
    const priceOf = (p) => mode==='retail' ? p.retailPrice : p.wholesalePrice;
    const minQty  = (p) => mode==='retail' ? 1 : (p.moq||1);

    function estDeliveryFee(area, subtotal){
      // Free delivery anywhere if subtotal meets threshold
      if(subtotal >= FREE_THRESHOLD) return 0;
      if(area.includes('Kampala')) return 5000;
      if(area.includes('Wakiso')) return 8000;
      if(area.includes('Entebbe')) return 10000;
      return 15000; // Upcountry baseline
    }

    function ratingStars(r){
      const full = Math.floor(r);
      const half = r - full >= 0.5 ? 1 : 0;
      const empty = 5 - full - half;
      return '★'.repeat(full) + (half?'½':'') + '☆'.repeat(empty);
    }
    function tuneQtyInputs(){
      document.querySelectorAll('input[id^="qty-"]').forEach(el=>{
        el.setAttribute('inputmode','numeric');
        el.setAttribute('pattern','[0-9]*');
      });
    }

    // ====== Filters / Chips ======
    function renderChips(){
      chips.innerHTML = CATEGORIES.map(c => `<button class="chip" data-cat="${c.id}" aria-pressed="${c.id===activeCat}">${c.label}</button>`).join('');
    }

    chips.addEventListener('click', (e)=>{
      const b = e.target.closest('[data-cat]');
      if(!b) return; activeCat = b.dataset.cat; render(); renderChips();
    });

    searchInput.addEventListener('input', ()=> render());
    sortSel.addEventListener('change', ()=> render());

    // ====== Mode toggle ======
    function setMode(newMode){
      mode = newMode;
      document.body.setAttribute('data-mode', mode);
      modeTabs.querySelectorAll('button[data-mode]').forEach(btn=>{
        btn.setAttribute('aria-pressed', btn.dataset.mode === mode ? 'true' : 'false');
      });
      modeBadge.textContent = mode==='retail' ? 'Retail Mode – single units' : 'Wholesale Mode – bulk (MOQ applies)';
      render();
    }
    modeTabs.addEventListener('click', (e)=>{
      const b = e.target.closest('button[data-mode]');
      if (!b) return; setMode(b.dataset.mode);
    });

    // ====== Render products ======
    function render(){
      const q = searchInput.value.trim().toLowerCase();
      let items = PRODUCTS.filter(p => (activeCat==='all' || p.category===activeCat) && (!q || (p.name+" "+p.desc).toLowerCase().includes(q)));
      const sort = sortSel.value;
      if(sort==='priceAsc') items.sort((a,b)=>priceOf(a)-priceOf(b));
      if(sort==='priceDesc') items.sort((a,b)=>priceOf(b)-priceOf(a));
      if(sort==='name') items.sort((a,b)=>a.name.localeCompare(b.name));
      // default pop: keep original order but bump tag items
      if(sort==='pop') items.sort((a,b)=> (b.tag?1:0)-(a.tag?1:0));

      grid.innerHTML = items.map(p=>{
        const pr = priceOf(p);
        const imgSrc = withBase(p.img);
        const wholesaleHint = `Wholesale: ${fmtUGX(p.wholesalePrice)} (MOQ ${minQty(p)})`;
        const retailHint = `Retail: ${fmtUGX(p.retailPrice)}`;
        const save = p.retailPrice - p.wholesalePrice;
        const hint = mode==='retail' ? wholesaleHint : `${retailHint} • Save ${save>0?fmtUGX(save):'UGX 0'} / unit`;
        return `<div class=\"card\">
          <div style=\"position:relative\">
            ${p.tag?`<span class=\\"tag\\">${p.tag}</span>`:''}
            <span class=\"rating\" title=\"${p.rating||4.5} out of 5\">${(p.rating||4.5).toFixed(1)} ★</span>
            <img src=\"${imgSrc}\" alt=\"${p.name}\" loading=\"lazy\"
                 onerror=\"this.onerror=null; this.src='https://images.unsplash.com/photo-1585421514284-efb74c2b9d6b?q=80&w=800&auto=format&fit=crop';\">
          </div>
          <div class=\"body\">
            <h3>${p.name} ${mode==='wholesale'? `<span class=\\"moq\\" title=\\"Minimum order quantity\\">MOQ ${minQty(p)}</span>`:''}</h3>
            <p class=\"muted\" style=\"min-height:34px\">${p.desc}</p>
            <div class=\"price\">${fmtUGX(pr)} ${mode==='retail'? '(Retail)':'(Wholesale)'} ${mode==='wholesale'? `<span class=\\"moq\\">MOQ ${minQty(p)}</span>`:''}</div>
            <div class=\"muted\" style=\"font-size:12px; margin-top:-4px\">${hint}</div>
            <div class=\"qty\">
              <label>Qty:
                <input type=\"number\" id=\"qty-${p.id}\" value=\"${minQty(p)}\" min=\"${minQty(p)}\" step=\"${minQty(p)}\" aria-label=\"Quantity for ${p.name}\">
              </label>
              <span class=\"muted\">/ ${p.unit}</span>
            </div>
            <div class=\"stack\">
              <button class=\"button\" onclick=\"addToCart('${p.id}')\">Add to Cart</button>
              <button class=\"button buyNow\" onclick=\"buyNow('${p.id}')\">Buy Now (COD)</button>
            </div>
          </div>
        </div>`;
      }).join('');
      if (typeof tuneQtyInputs==='function') tuneQtyInputs();
    }

    // ====== Cart ops ======
    function addToCart(id){
      const product = PRODUCTS.find(x=>x.id===id);
      const qtyInput = document.getElementById(`qty-${id}`);
      let qty = parseInt(qtyInput?.value)||minQty(product);
      if(qty < minQty(product)) qty = minQty(product);
      const unitPrice = priceOf(product);
      const key = id+':'+mode;
      const existing = cart.get(key);
      cart.set(key, {product, qty:(existing?existing.qty:0)+qty, unitPrice, mode});
      updateCartUI();
      openDrawer();
    }

    function buyNow(id){
      const product = PRODUCTS.find(x=>x.id===id);
      const qtyInput = document.getElementById(`qty-${id}`);
      let qty = parseInt(qtyInput?.value)||minQty(product);
      if(qty < minQty(product)) qty = minQty(product);
      const unitPrice = priceOf(product);
      const msg = `Hi Orji Supplies, I want to order (Cash on Delivery):\n• ${product.name} x${qty} @ ${fmtUGX(unitPrice)} (${mode})`;
      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
      window.open(url, '_blank');
    }

    function updateCartUI(){
      cartLines.innerHTML='';
      let subtotal=0; let count=0;
      cart.forEach(({product, qty, unitPrice, mode})=>{
        const lineTotal = unitPrice*qty;
        subtotal+=lineTotal; count+=qty;
        const div = document.createElement('div');
        div.style.borderBottom='1px dashed var(--line)';
        div.style.padding='8px 0';
        div.innerHTML = `<div style="display:flex; justify-content:space-between; gap:8px; align-items:center">
            <div><strong>${product.name}</strong><br><span class="muted">${mode==='retail'?'Retail':'Wholesale'} • ${fmtUGX(unitPrice)} × ${qty}</span></div>
            <div><strong>${fmtUGX(lineTotal)}</strong><br><button class="button" style="padding:6px 8px; font-size:12px" onclick="removeLine('${product.id}','${mode}')">Remove</button></div>
          </div>`;
        cartLines.appendChild(div);
      });
      const fee = estDeliveryFee(areaSel.value, subtotal);
      grandTotal.textContent = 'Total: ' + fmtUGX(subtotal + fee) + (fee? ` (incl. est delivery ${fmtUGX(fee)})` : ' (Free delivery)');
      cartCount.style.display = count>0? 'inline-block':'none';
      cartCount.textContent = count;

      const href = cartToWhatsApp(subtotal, fee);
      checkoutFab.href = href;

      // Free delivery progress UI
      if (typeof FREE_THRESHOLD !== 'undefined'){
        if(subtotal >= FREE_THRESHOLD){
          freeNote.textContent = '🎉 You qualify for FREE delivery!';
          freeFill.style.width = '100%';
        } else {
          const remain = FREE_THRESHOLD - subtotal;
          freeNote.textContent = `${fmtUGX(remain)} away from free delivery`;
          freeFill.style.width = Math.max(4, Math.min(100, Math.round((subtotal / FREE_THRESHOLD)*100))) + '%';
        }
      }
      updateFabVisibility();
    }

    function removeLine(id, m){
      cart.delete(id+':'+m); updateCartUI();
    }

    function cartToWhatsApp(subtotal=0, fee=0){
      if(cart.size===0) return `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent('Hi Orji Supplies')}`;
      let lines=[];
      cart.forEach(({product, qty, unitPrice, mode})=>{
        lines.push(`• ${product.name} x${qty} @ ${fmtUGX(unitPrice)} (${mode})`);
      });
      const msg = `Hello Orji Supplies, here is my order (Cash on Delivery):\n${lines.join('\n')}\nSubtotal: ${fmtUGX(subtotal)}\nEst. Delivery: ${fmtUGX(fee)}\nTotal (est): ${fmtUGX(subtotal+fee)}`;
      return `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
    }

    // Drawer + FAB
    function updateFabVisibility(){
      const visible = cart.size > 0 && drawer.classList.contains('open');
      checkoutFab.style.display = visible ? 'flex' : 'none';
      if (visible) checkoutFab.style.bottom = '16px';
    }
    function openDrawer(){ drawer.classList.add('open'); updateFabVisibility(); }
    closeDrawer.onclick=()=>{ drawer.classList.remove('open'); updateFabVisibility(); };
    cartBtn.onclick=()=>{ drawer.classList.toggle('open'); updateFabVisibility(); };

    // ====== Checkout Modal (Cash on Delivery details) ======
    openCheckout.addEventListener('click', ()=>{
      if(cart.size===0){ alert('Your cart is empty. Please add items first.'); return; }
      // preset area from drawer
      custArea.value = areaSel.value;
      checkoutModal.classList.add('open');
    });
    closeModal.addEventListener('click', ()=> checkoutModal.classList.remove('open'));
    checkoutModal.addEventListener('click', (e)=>{ if(e.target===checkoutModal) checkoutModal.classList.remove('open'); });

    placeOrderBtn.addEventListener('click', (e)=>{
      // validate minimal details
      const name = (custName.value||'').trim();
      const phone = (custPhone.value||'').trim();
      if(!name || !phone){ alert('Please enter your name and phone so our rider can reach you.'); e.preventDefault(); return; }
      let subtotal=0; let lines=[];
      cart.forEach(({product, qty, unitPrice, mode})=>{
        subtotal += unitPrice*qty;
        lines.push(`• ${product.name} x${qty} @ ${fmtUGX(unitPrice)} (${mode})`);
      });
      const fee = estDeliveryFee(custArea.value, subtotal);
      const text = `Order Request – CASH ON DELIVERY\n\nCustomer: ${name}\nPhone: ${phone}\nArea: ${custArea.value}\nTime: ${custTime.value}\nAddress: ${custAddr.value||'-'}\nNote: ${custNote.value||'-'}\n\nItems:\n${lines.join('\n')}\nSubtotal: ${fmtUGX(subtotal)}\nEst. Delivery: ${fmtUGX(fee)}\nTotal (est): ${fmtUGX(subtotal+fee)}\n\nPlease confirm availability & delivery time.`;
      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`;
      placeOrderBtn.href = url; // follow link
    });

    // ====== Init ======
    document.getElementById('year').textContent = new Date().getFullYear();
    renderChips();
    render();
  </script>
</body>
</html>
